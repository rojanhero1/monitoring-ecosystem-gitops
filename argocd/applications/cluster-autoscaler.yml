apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: cluster-autoscaler
  namespace: argocd
spec:
  project: default

  source:
    repoURL: https://kubernetes.github.io/autoscaler
    chart: cluster-autoscaler
    targetRevision: 9.29.0
    helm:
      releaseName: cluster-autoscaler
      values: |
        autoDiscovery:
          clusterName: staging-eks

        awsRegion: us-west-2

        rbac:
          serviceAccount:
            create: true
            name: cluster-autoscaler
            annotations:
              eks.amazonaws.com/role-arn: arn:aws:iam::687398153695:role/Cloudhero-staging-eks-ClusterAutoscalerIRSA

        extraArgs:
          skip-nodes-with-local-storage: false
          skip-nodes-with-system-pods: false
          balance-similar-node-groups: true
          skip-nodes-with-custom-controller-pods: false

  destination:
    server: https://kubernetes.default.svc
    namespace: kube-system

  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ApplyOutOfSyncOnly=true
      - ServerSideApply=true
